- cve_id: CVE-2023-53171
  description: |-
    In the Linux kernel, the following vulnerability has been resolved:

    vfio/type1: prevent underflow of locked_vm via exec()

    When a vfio container is preserved across exec, the task does not change,
    but it gets a new mm with locked_vm=0, and loses the count from existing
    dma mappings.  If the user later unmaps a dma mapping, locked_vm underflows
    to a large unsigned value, and a subsequent dma map request fails with
    ENOMEM in __account_locked_vm.

    To avoid underflow, grab and save the mm at the time a dma is mapped.
    Use that mm when adjusting locked_vm, rather than re-acquiring the saved
    task's mm, which may have changed.  If the saved mm is dead, do nothing.

    locked_vm is incremented for existing mappings in a subsequent patch.
  severity: medium
  pattern:
    type: manual
    note: This signature requires manual review and pattern definition. See IMPLEMENTATION_PLAN.md section 2.4 for pattern types.
  references:
  - https://git.kernel.org/stable/c/b0790dff0760b7734cf0961f497ad64628ca550b
  - https://nvd.nist.gov/vuln/detail/CVE-2023-53171
  - https://git.kernel.org/stable/c/eafb81c50da899dd80b340c841277acc4a1945b7
  - https://git.kernel.org/stable/c/5a271242716846cc016736fb76be2b40ee49b0c3
  - https://git.kernel.org/stable/c/046eca5018f8a5dd1dc2cedf87fb5843b9ea3026
  - https://git.kernel.org/stable/c/a6b2aabe664098d5cf877ae0fd96459464a30e17

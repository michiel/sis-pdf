# 20260201 Triage Workplan

## Goal
Translate the "next steps" roadmap into a sequenced checklist that can be executed across the core scanner, detectors, and documentation so emergent primitives, canonicalisation, action telemetry, and reader-context scoring land together with corresponding QA hooks.

## Steps
1. **Establish canonicalisation metadata** ✅
   - Define the canonical view that detectors should consume, including normalized name resolution, canonical filter chains, and incremental-update deduplication. Implement the pass inside `sis_pdf_core`, expose the canonical indices via the scan context, and document the metadata emitted (e.g., # of incremental versions stripped, filters rewritten).
   - Add regression/fixture tests feeding obfuscated PDFs to ensure the canonical view stabilises object ordering and filter naming.
   - Surface canonicalisation signals in the structural summary and ensure downstream components (report generator, CLI) can report the diff for transparency.
2. **Extend findings/report schema with telemetry** ✅
   - Added `impact`, `reader_impacts`, `action_type`, `action_target`, and `action_initiation` to `Finding` along with serde helpers and a construction template so every detector pathway starts from a sane baseline.
   - Documented the new telemetry fields in `docs/findings.md` and wired `reader_context` to emit structured `reader_impacts` plus the legacy `reader.impact.*` metadata.
   - Next: teach the action/embedded-file detectors and CLI query/report outputs to populate and expose the new metadata so downstream workflows can filter on telemetry values without parsing `meta`.
3. **Reader-context scoring enhancements** ✅
   - `reader_context` now annotates every finding produced by `run_detectors` and the report generator with structured `reader_impacts`, the legacy `reader.impact.*` keys, and the summary string so scanners and CLI consumers share a single reference.
   - `predicate_context_for_finding` exposes the new `impact`, `action_type`, `action_target`, and `action_initiation` fields alongside the updated meta map, allowing `sis query findings --where` to filter on the telemetry directly.
   - Documented the new predicate targets in `docs/query-predicates.md`.
4. **Emerging primitive heuristics and metadata**
   - Inventory the CVEs referenced in `plans/20260201-next-steps.md` and `docs/research/202602-pdf-attack-surface-breakdown.md` (gvar, JBIG2 chains, zero-click imagery) and assign them to detectors (`font_analysis`, `image_analysis`, `filter_chain_anomaly`, etc.).
   - Implement semantic heuristics that produce clear CVE metadata (e.g., gvar glyph-count mismatches with CVE=2025-27363, filter chain JBIG2+ASCII with CVE references). Ensure each heuristic emits `meta` entries for the CVE ID and matched attack surface category.
   - Added zero-click JBIG2 heuristics (strip dimensions + JBIG2 filter) that emit `cve=CVE-2021-30860`, `attack_surface=Image codecs / zero-click JBIG2`, impact=High, and documentation/test coverage.
   - Add fixtures/tests covering each primitive and assert the detectors emit the expected metadata with canonicalisation and reader scoring in place.
5. **Validation, docs, and cadence**
   - Update `plans/20260201-threat-intel-cadence.md` to mention the automation refresh, daily/weekly sign-offs, and release-note hooks introduced earlier.
   - Ensure `docs/threat-intel-tracker.md` includes the CVEs we plan to cover and annotate each row with owner, severity, impact, confidence, and linked tests.
   - Link the fixtures/detectors to the tracker entries so triage steps and CI coverage remain visible for every new heuristic.

## Considerations
- Treat any automation changes or new detectors as needing regression tests and docs updates before completion.
- Coordinate reader-impact metadata with the CLI output (e.g., `sis query findings` should expose the new fields) and ensure no existing pipelines break when canonical indices shift.
- Keep an eye on rate limits and idempotency when re-running the CVE automation as part of this effort; use the new plan to tie the workflow to weekly triage.

## Upcoming work
1. **Emerging primitives & detectors**
   - Built a JBIG2 filter-chain heuristic that tags chains mixing JBIG2 and ASCII filters with the CVEs called out in the research, surfaces `impact=high`, and documents the detection in `docs/threat-intel-tracker.md`.
   - Added unit tests for the new heuristic so analysts can confirm the primitive remains observable even when canonical filter chains change.
   - Next: add the remaining primitives (variable-font gvar anomalies, zero-click imagery) plus fixtures so every tracker row links back to a validator.
2. **Validation & cadence**
   - ✅ Ran `sis scan crates/sis-pdf-core/tests/fixtures/actions/launch_cve_2010_1240.pdf --deep --runtime-profile --runtime-profile-format json` (parse 0ms / detection 2ms per JSON profile) to confirm the Stage 1 SLOs from `docs/performance.md`.
   - Populate the weekly triage tracker (`plans/20260201-threat-intel-cadence.md`) with automation status and detection coverage per CVE.
3. **Gvar fixture coverage & predicate docs**
   - Create/refresh the gvar glyph-count mismatch fixture so the CVE-2025-27363 primitive is exercised end-to-end and metadata includes `cve`/`attack_surface`.
   - Extend `docs/query-predicates.md` (and release notes) so analysts can filter findings via `meta.cve`, `meta.attack_surface`, and other telemetry keys.

## Next actions & design choices

1. **Centralise `Finding` construction** – introduce a helper that provides default `impact`, `reader_impacts`, and `action_*` fields so every detector, test, and runner path can focus on supply the variable bits (surface/kind/severity/confidence/meta). This avoids repetitive `..` blocks and makes future schema tweaks easier.
2. **✅ Cover the expanded `Confidence` space** – `Certain`, `Tentative`, and `Weak` now exist, so update every match/scoring switch (reports, `features_extended`, `ir_enhanced`, heuristics) to handle them. The `FontConfidence` enum now mirrors the core variants, `features_extended` gains per-bucket counts/high-severity counters, and `map_confidence` now preserves the richer set so CLI output stays consistent.
3. **Document & expose the telemetry** – once the code emits `reader_impacts`, `impact`, and action metadata consistently, update `docs/findings.md` and the query/text outputs to describe the new fields (including the human-readable summary inserted into `reader.impact.summary`) so analysts can rely on the enriched reports.
4. **Resume subsequent plan items** – after the schema work and docs surface, continue with the remaining steps above (emerging primitives, fixtures, tracker automation) to keep the triage cadence aligned with the research-driven threats.
5. **Track feature-extraction regressions** – note that `cargo test -p sis-pdf-core` currently fails in `tests/feature_extraction.rs` (`rich_media_swf`, `graph_features_extended`, and `encryption_features_extraction`) because the sampled fixtures no longer produce `swf_actionscript_count`, `max_chain_length`, or `high_entropy_stream_count` values above zero. Revisit these expectations once the supporting detectors or fixtures are re-aligned with the canonical metadata.

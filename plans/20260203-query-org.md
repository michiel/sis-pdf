# 20260203 Query ORG/IR plan

## Context

The REPL in `sis query` currently covers structural/content/finding queries but does not expose the ORG/IR exports (`export org`/`export ir`), which are useful for narrative and intent inspection. Analysts want to view or pipe ORG/IR graphs without dropping into `sis export-org` or `sis export-ir` commands, especially with the new readable output/piping affordances.

## Goals

1. Surface ORG and IR exports inside the REPL (e.g., via `org` and `ir` commands) so users can generate the graph data alongside existing queries.
2. Respect existing format controls and pipe handling (`:json`, `:yaml`, `:readable`, piping) while defaulting to a suitable representation for graph outputs.
3. Document the new commands and update tests to cover interactive usage.

## Implementation steps

1. Extend `commands::query::Query` to include `ExportOrgDot`, `ExportOrgJson`, `ExportIrText`, etc., if not already exposed, so the parser can return them via `parse_query` when `org`/`ir` inputs are given.
2. Adjust `run_query_repl` to recognise `org` and `ir` command lines before the standard query path, dispatch the appropriate export (respecting format toggles and predicate state), format the result (dot/json/text), and feed it through the same piping handling.
3. Pick sensible defaults: `org` should default to `:readable` (maybe a summary table) or `dot` for graph view, while `ir` might default to `text` or `json`. Allow the `:json/:yaml` toggles (and a new `:dot` if needed) to override when analysts need machine-readable output.
4. Ensure the `split_repl_pipe`/`run_repl_pipeline` logic works identically for `org`/`ir` commands so the output can be chained into external tools.
5. Add regression tests covering the REPL running `org` and `ir` commands (with and without pipes) and verifying output format toggles behave as expected.
6. Document the new commands and any format defaults in `docs/query-interface.md` (REPL help section, new examples).
7. After implementation, rerun `cargo test -p sis-pdf` and re-evaluate relevant docs to keep the release notes consistent.

## Status

- Added `org`/`ir` aliases to `parse_query`, covering dot/text/JSON variants, and exposed them via the REPL help/documentation.
- Added regression coverage for the new aliases and confirmed that the plan still makes use of existing export formatting when toggles are applied.

# egui UI plan for sis

## Design Principles

1. **Triage-first** â€” default view answers "is this malicious?" in under 3 seconds
2. **Everything is linked** â€” findings â†’ objects â†’ graph nodes â†’ evidence are all cross-referenced and clickable
3. **Progressive disclosure** â€” summary â†’ table â†’ detail â†’ raw bytes
4. **Keyboard-friendly** â€” power users never need the mouse for common workflows
5. **Export-ready** â€” any data view can be copied or exported

## Analyst Workflow Phases

The UI is structured around how a security analyst actually works:

```
Drop PDF â†’ Triage (is it bad?) â†’ Investigate (how is it bad?) â†’ Extract (get IOCs/payloads) â†’ Report (share findings)
```

## Startup

- Keep the start screen as-is (drop/upload PDF)
- Show a progress bar for uploading/processing
- Show scan duration when complete

## Application Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fileâ–¾  [sample1.pdf] [sample2.pdf]           âš™  ðŸŒ™/â˜€  â”‚  â† top-bar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ report.pdf â”‚ 482KB â”‚ v1.7 â”‚ 127 objs â”‚ 2C 5H 3M 1L 12I â”‚ 4â›“ â”‚  â† workspace-top-bar
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    â”‚                                                    â”‚
â”‚ ðŸ“Š â”‚  â”Œâ”€ Findings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€ Detail â”€â”€â”€â”€â”€â” â”‚
â”‚ ðŸ” â”‚  â”‚ [Câ–¾][Hâ–¾][Mâ–¾][Lâ–¾][Iâ–¾] ðŸ”Ž   â”‚ â”‚ JS_OBFUSC... â”‚ â”‚
â”‚ ðŸ“‹ â”‚  â”‚ Sev Conf Kind    Surface   â”‚ â”‚              â”‚ â”‚
â”‚ ðŸ”— â”‚  â”‚ â–ˆâ–ˆC Cert js_obf  JavaScriptâ”‚ â”‚ Description  â”‚ â”‚
â”‚ ðŸ“¦ â”‚  â”‚ â–ˆâ–ˆH Strg launch  Actions   â”‚ â”‚ Evidence     â”‚ â”‚
â”‚ ðŸŒ â”‚  â”‚ â–ˆâ–ˆM Prob xfa_sc  Forms     â”‚ â”‚ Objects [â†’]  â”‚ â”‚
â”‚ âš¡ â”‚  â”‚                            â”‚ â”‚ Reader Impactâ”‚ â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚    â”‚                                                    â”‚
â”œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ > query: findings --where "severity == 'Critical'"      â”‚  â† command bar
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Top Bar

- The egui.rs demo site is the template for this app
- Far left: "File.." menu with dropdown containing "Open file.." (opens drop/upload dialog)
- Center: PDF tab labels â€” each open PDF adds a navigation item (max 5)
- Far right: settings icon, theme toggle (light/dark)
- Clicking a tab label switches the workspace to that PDF's context

## Workspace Top Bar

Always visible. Shows at a glance for the active PDF:

- Filename, file size, PDF version
- Object count, page count
- Severity breakdown as colored badges: `2C 5H 3M 1L 12I`
- Chain count with icon
- Scan duration
- ML verdict badge (if available): `MALICIOUS` / `SUSPICIOUS` / `BENIGN`

**Interaction:** Clicking a severity badge filters the findings table to that severity. Clicking chain count opens chains panel.

## Left Navigation Column

Narrow column with icon buttons to open workspace panels:

- Findings (default, opens on load)
- Chains
- Metadata
- Objects
- Graph
- Evidence/Hex

Each button opens a resizable, closeable window in the workspace. Multiple panels can be open simultaneously.

## Panel Specifications

### 1. Findings Table

Default panel. Sortable, filterable, searchable.

**Columns:**

| Column     | Sortable | Notes                                              |
|------------|----------|----------------------------------------------------|
| Severity   | yes      | Color-coded badge (red/orange/yellow/blue/gray)    |
| Confidence | yes      | Certain â†’ Heuristic                                |
| Kind       | yes      | e.g. `js_obfuscation`, `launch_action`             |
| Surface    | yes      | Attack surface category                            |
| Title      | no       | Truncated, full on hover                           |
| Objects    | no       | Count of related objects, clickable                |

**Filters (top of table):**

- Severity toggles (C/H/M/L/I)
- Attack surface dropdown
- Confidence minimum slider
- Text search across kind + title + description
- "Has CVE" toggle
- "Auto-triggered" toggle (findings with `action_initiation == "automatic"`)

**Interactions:**

- Click row â†’ opens Detail panel for that finding
- Double-click row â†’ opens Detail panel AND highlights related objects in graph (if open)
- Right-click â†’ context menu: "Show in graph", "Copy as JSON", "Filter to this kind"
- Multi-select (Shift+click) â†’ bulk operations (export selected, compare)

### 2. Finding Detail Panel

Right sidebar or floating window. Shows full context for the selected finding.

**Sections (collapsible):**

- **Header:** Severity + Confidence badges, Kind, Surface, Title
- **Description:** Full finding description text
- **Evidence:** Each `EvidenceSpan` shown with:
  - Label and description
  - Hex/text preview of the evidence bytes
  - "View in hex viewer" link â†’ opens Evidence panel at that offset
- **Related Objects:** List of object IDs, each clickable â†’ opens Object Inspector
- **Chain Membership:** If this finding is part of a chain, show the chain with this finding highlighted
- **Reader Impacts:** Table of Reader â†’ Version â†’ Impact Level â†’ Notes
- **CVE References:** Linked CVE IDs (clickable â†’ open in browser on native, show details on WASM)
- **Remediation:** If present, show recommended action
- **Metadata:** Key-value pairs from `meta` HashMap
- **YARA:** If present, show matching rule name and tags

### 3. Exploit Chains Panel

Dedicated view for chain analysis. Two sub-views:

**List view** â€” table of chains sorted by score:

| Score | Trigger    | Action     | Payload    | Findings | Path                              |
|-------|------------|------------|------------|----------|-----------------------------------|
| 0.95  | OpenAction | JavaScript | heap_spray | 3        | Catalogâ†’OpenActionâ†’JSâ†’Stream      |

**Flow view** â€” visual representation of selected chain as a horizontal flow diagram:

```
[Trigger: OpenAction] â”€â”€â†’ [Action: JavaScript] â”€â”€â†’ [Payload: heap_spray]
     obj 1 0                    obj 8 0                  obj 12 0
```

Each node is clickable â†’ opens Object Inspector.

**Interactions:**

- Select chain â†’ highlights its nodes in the ORG graph (if open)
- Click finding ID in chain â†’ jumps to that finding in the Findings table
- "Explain chain" button â†’ shows `reasons` in a tooltip/panel
- Group chains by `group_id` with expand/collapse

### 4. Object Inspector

Browse and inspect individual PDF objects.

**Layout:** Object tree/list on the left, object detail on the right.

**Object list:**

- All objects listed by ID
- Filterable by type (Page, Action, Stream, Font, Image, etc.)
- Searchable by object ID

**Object detail (for selected object):**

- Object ID (num, gen)
- Type classification
- Dictionary view: key-value pairs, with reference values clickable
- Stream content (if present):
  - Decoded view (text/hex toggle)
  - Raw view
  - Filter chain info (e.g., FlateDecode â†’ ASCIIHexDecode)
  - Length, entropy
- **References to this object:** which objects reference this one
- **References from this object:** what this object references
- **Findings on this object:** list of findings mentioning this object ID
- **Roles:** from ORG graph (JsContainer, UriTarget, etc.)

**Interactions:**

- Click reference â†’ navigates to that object (with back/forward navigation stack)
- Click finding â†’ opens Detail panel
- "Show in graph" â†’ highlights in ORG graph
- "Extract stream" â†’ downloads decoded stream content (WASM: browser download, native: file save dialog)
- "Copy as JSON" â†’ copies object dict to clipboard

### 5. Metadata Panel

PDF document metadata and structural info.

**Sections:**

- **Document Info:** Creator, Producer, Title, Author, Subject, Keywords, CreationDate, ModDate
- **PDF Version** and feature flags
- **Encryption:** Status, algorithm, key length, permissions
- **Page Count** with page size info
- **XRef Summary:**
  - Number of xref sections (indicates incremental updates)
  - Startxref positions
  - Deviations detected (with severity)
- **Revision Timeline:** Visual timeline of incremental updates if multiple revisions exist, showing what changed in each revision
- **Temporal Signals:** If available â€” creation/modification patterns, timezone analysis
- **Supply Chain Indicators:** Tool chain detection from metadata

**Interactions:**

- Click deviation â†’ shows finding if one exists
- Revision timeline entries are expandable to show objects added/modified/deleted

### 6. ORG Graph Viewer

Interactive directed graph visualization of the PDF Object Reference Graph.

**Rendering:**

- Force-directed or hierarchical layout (analyst choice)
- Nodes colored by type (Page=blue, Action=red, Stream=green, Font=gray, etc.)
- Suspicious edges drawn in red/dashed
- Edge labels showing relationship type
- Node labels showing obj ID + type

**Navigation:**

- Pan and zoom (scroll wheel + drag)
- Click node â†’ select, show info tooltip
- Double-click node â†’ open in Object Inspector
- Minimap in corner for large graphs

**Filtering:**

- Filter by node type (show only Actions + Streams)
- Filter by edge type (show only suspicious edges)
- "Show only chain path" â€” filter to nodes/edges in a selected chain
- Depth slider â€” show only N hops from selected node

**Highlighting:**

- When a finding is selected in Findings table, highlight related objects in graph
- When a chain is selected, highlight its path
- Search for object ID â†’ center and highlight

**Layout controls:**

- Reset layout
- Toggle labels
- Toggle edge labels
- Export as SVG/PNG (native) or screenshot (WASM)

**Performance:**

- For large graphs (1000+ nodes), use level-of-detail rendering
- Cluster by page or by type for large documents
- Lazy load edges on zoom
- Limit to 500 visible nodes at once with expand-on-demand

### 7. Evidence / Hex Viewer

Raw data viewer for evidence inspection.

- Hex view with ASCII sidebar (classic hex editor layout)
- Highlight regions corresponding to evidence spans
- Multiple evidence spans shown as colored overlays
- Offset navigation (jump to byte offset)
- Search within raw content
- Text/Hex/Both view toggle
- "Decode as" dropdown: UTF-8, UTF-16, ASCII, Base64, hex-escaped

**Entry points:**

- Click "view evidence" on a finding â†’ opens hex viewer at that offset
- Click "view raw" on an object stream â†’ shows decoded stream bytes
- From command bar: `stream 8 0 --raw` output â†’ hex view

### 8. Command Bar (Query/REPL)

Bottom-anchored command input, always accessible. Not a full-window REPL, but a persistent command bar (like VS Code's command palette or browser dev tools console).

**UI:**

- Single-line input with autocomplete
- Results appear in a slide-up panel (resizable)
- History with up/down arrow
- Tab completion for query names and fields

**WASM-compatible query subset:**

- All metadata queries (`pages`, `creator`, `objects.count`, etc.)
- All finding queries (`findings`, `findings.high`, etc.)
- All content queries (`js`, `urls`, `embedded`, etc.)
- Chain queries (`chains`, `chains.count`)
- Object queries (`show 8 0`, `references 8 0`)
- Format switching (`:json`, `:yaml`, `:readable`)
- Predicate filtering (`:where severity == 'High'`)

**Not available on WASM (grayed out with tooltip):**

- Shell piping (`|`)
- File redirection (`>`)
- `--extract-to` (replaced by browser download)

**GUI-specific commands:**

- `goto 8 0` â†’ open Object Inspector for obj 8 0
- `graph focus 8 0` â†’ center graph on obj 8 0
- `highlight chain:1` â†’ highlight chain 1 in graph
- `export report` â†’ trigger report download

**Results rendering:**

- Tables render as actual sortable tables
- JSON renders with syntax highlighting
- DOT export renders inline as a mini graph preview

## Cross-Panel Linking

All panels are interconnected. These are the primary cross-references:

| From                    | Action              | Opens / Highlights               |
|-------------------------|---------------------|----------------------------------|
| Findings table row      | click               | Detail panel                     |
| Findings table row      | double-click        | Detail panel + graph highlight   |
| Detail panel object ID  | click               | Object Inspector                 |
| Detail panel evidence   | "view in hex"       | Evidence/Hex viewer at offset    |
| Detail panel chain      | click               | Chains panel, chain selected     |
| Chain flow node         | click               | Object Inspector                 |
| Chain selection         | auto                | Graph highlights chain path      |
| Object Inspector ref    | click               | Object Inspector (navigates)     |
| Object Inspector finding| click               | Detail panel                     |
| Object Inspector        | "show in graph"     | Graph centers on object          |
| Graph node              | double-click        | Object Inspector                 |
| Graph node              | click               | Info tooltip                     |
| Summary severity badge  | click               | Findings table filtered          |
| Summary chain count     | click               | Chains panel                     |
| Command bar `goto`      | enter               | Object Inspector                 |
| Command bar `graph focus`| enter              | Graph centers on object          |

## Workflows

### Workflow 1: Quick Triage (< 30 seconds)

1. Drop PDF
2. See summary bar â†’ "2 Critical, 5 High" + ML verdict badge
3. Click Critical badge â†’ findings filtered to Critical
4. Scan titles â†’ "JavaScript heap spray detected", "OpenAction automatic execution"
5. Decision: escalate / quarantine / safe

### Workflow 2: Exploit Chain Investigation (2-5 min)

1. Drop PDF â†’ see "4 chains" in summary bar
2. Open Chains panel â†’ sort by score
3. Select highest-scoring chain â†’ see flow: Trigger(OpenAction) â†’ Action(JavaScript) â†’ Payload(heap_spray)
4. Click payload node â†’ Object Inspector shows decoded JavaScript
5. Open ORG graph â†’ chain path highlighted
6. Trace through graph to understand object relationships
7. Click evidence on JS finding â†’ hex viewer shows obfuscated code

### Workflow 3: IOC Extraction (1-3 min)

1. After investigation, extract indicators
2. Command bar: `urls` â†’ see all URLs in document
3. Command bar: `js` â†’ see all JavaScript, click "Extract" to download
4. Command bar: `embedded` â†’ list embedded files with types and hashes
5. Select findings â†’ "Copy as JSON" â†’ paste into SIEM/ticketing system
6. Command bar: `export report` â†’ download full JSON report

### Workflow 4: PDF Structure Analysis (forensic deep-dive)

1. Open Metadata panel â†’ check Creator/Producer for known exploit kit signatures
2. Check revision timeline â†’ see if incremental updates added suspicious objects
3. Open Object Inspector â†’ browse objects by type
4. Filter to Action objects â†’ check for OpenAction, AA entries
5. Follow references through object graph
6. Open ORG graph â†’ filter to suspicious edges only
7. Command bar: `canonical-diff` â†’ compare revisions
8. Command bar: `cycles` â†’ check for reference cycles (common evasion)

### Workflow 5: Multi-PDF Comparison

1. Open PDF A (tab 1), Open PDF B (tab 2)
2. Switch between tabs comparing:
   - Same creator/producer metadata?
   - Similar JavaScript patterns?
   - Same embedded file hashes?
   - Same exploit chain structure?
3. Tab switching enables manual comparison (true side-by-side diff is a future feature)

## Keyboard Shortcuts

| Key              | Action                                         |
|------------------|-------------------------------------------------|
| `Ctrl+O`         | Open file                                      |
| `Ctrl+1..5`      | Switch to PDF tab 1-5                          |
| `Ctrl+K`         | Focus command bar                              |
| `F`              | Open/focus Findings                            |
| `C`              | Open/focus Chains                              |
| `G`              | Open/focus Graph                               |
| `O`              | Open/focus Object Inspector                    |
| `M`              | Open/focus Metadata                            |
| `Esc`            | Close active panel / clear filter              |
| `â†‘/â†“`            | Navigate findings table                        |
| `Enter`          | Open detail for selected finding               |
| `1-5`            | Filter to severity level (when findings focused)|
| `Ctrl+Shift+C`   | Copy selected finding as JSON                  |

## State Management

Each PDF tab has its own independent `WorkspaceContext`:

- `AnalysisResult` (report, findings, chains, org graph)
- Selected finding index
- Active filters (severity, surface, confidence, search text)
- Sort state (column, direction)
- Open panels and their positions/sizes
- Graph viewport (pan, zoom, selected node)
- Command bar history
- Object Inspector navigation stack (back/forward)

The app holds a `Vec<WorkspaceContext>` and an `active_tab: usize`.

## Performance Guardrails

- **Findings table:** Virtualized scrolling for 100+ findings (egui `ScrollArea` with row recycling)
- **Object list:** Same virtualization for PDFs with 100k+ objects
- **Graph:** Level-of-detail rendering; collapse clusters beyond zoom threshold; limit to 500 visible nodes with expand-on-demand
- **Hex viewer:** Lazy loading â€” only render visible byte range
- **Command bar results:** Paginated, max 100 results shown with "load more"

## Implementation Priority

1. **Object Inspector** â€” biggest gap; analysts need to see objects
2. **Command bar** â€” enables power users immediately with existing query infrastructure
3. **Metadata panel** â€” quick win, simple data display
4. **Evidence/hex viewer** â€” makes findings actionable
5. **Graph viewer** â€” highest effort, highest value for chain analysis
6. **Multi-tab context** â€” enables comparison workflows
7. **Keyboard shortcuts** â€” polish for power users

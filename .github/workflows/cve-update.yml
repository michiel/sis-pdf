  name: Weekly CVE Update

  on:
    schedule:
      - cron: '0 2 * * 1'  # Every Monday at 2 AM
    workflow_dispatch:

  jobs:
    update-cves:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - uses: dtolnay/rust-toolchain@stable

        - name: Run CVE tool
          env:
            NVD_API_KEY: ${{ secrets.NVD_API_KEY }}
          run: |
            cargo build --release -p cve-update
            ./target/release/cve-update --verbose --days 7

        - name: Create PR
          uses: peter-evans/create-pull-request@v5
          with:
            title: 'Weekly CVE Signature Update'
            body: '⚠️ Manual review required for new signatures'
            branch: cve-update
